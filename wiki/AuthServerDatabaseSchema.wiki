#summary jungleauth database schema
#labels Phase-Design
= Introduction =

Jungle Auth uses MySQL to store subscriber and rateplan information. This is the database schema for storing that information.

= Schema =
== accesspoints ==
JungleAuth will only respond to a request from a AP if the source IP and AP MAC address match what is recorded in this table.

|| *Key* || *Name* || *Type* || *Description* ||
|| _PK_ || id || int(11) || Internal ID number. Auto incerments ||
|| || macaddr || varchar(12) || AP MAC address ||
|| || ipaddr || varchat(15) || AP management IP address ||
|| || descr || text || Friendly name / hostname ||

{{{
 CREATE TABLE `jungleauth`.`accesspoints` (
`id` INT NOT NULL AUTO_INCREMENT ,
`macaddr` VARCHAR( 12 ) NOT NULL ,
`ipaddr` VARCHAR( 15 ) NOT NULL ,
`descr` TEXT NOT NULL ,
PRIMARY KEY ( `id` ) ,
UNIQUE (
`macaddr` ,
`ipaddr`
)
) ENGINE = InnoDB 
}}}


== accessgroups ==
Access groups are used restrict a rateplan or radio to a specific set of APs. This table holds access group definitions.

|| *Key* || *Name* || *Type* || *Description* ||
|| _PK_ || id || int(11) || Internal ID number. Auto incerments ||
|| || name || varchar(20) || short name ||
|| || descr || text || group description ||

{{{
 CREATE TABLE `jungleauth`.`accessgroups` (
`id` INT NOT NULL AUTO_INCREMENT ,
`name` VARCHAR( 12 ) NOT NULL ,
`descr` TEXT NOT NULL ,
PRIMARY KEY ( `id` ) ,
UNIQUE (
`name`
)
) ENGINE = InnoDB 
}}}

==accessgroupaps==
This table tracks AP membership in access groups.

|| *Key* || *Name* || *Type* || *Description* ||
|| _PK_ || id || int(11) || Internal ID number. Auto incerments ||
|| _FK_ || groupid || int(11) || accessgroups.id of group that contains AP||
|| _FK_ || apid || int(11) || accesspoints.id AP that belongs to group.||

{{{
 CREATE TABLE `jungleauth`.`accessgroupaps` (
`id` INT NOT NULL AUTO_INCREMENT ,
`groupid` INT NOT NULL ,
`apid` INT NOT NULL ,
INDEX groupid_index( groupid ) ,
INDEX apid_index( apid ) ,
FOREIGN KEY ( groupid ) REFERENCES accessgroups( id ) ON DELETE RESTRICT ON UPDATE CASCADE ,
FOREIGN KEY ( apid ) REFERENCES accesspoints( id ) ON DELETE RESTRICT ON UPDATE CASCADE ,
PRIMARY KEY ( `id` )
) ENGINE = InnoDB 
}}}

== rateplans ==
A rate plan is a collection of bandwidth management parameters. A radio may be assigned to one rateplan at a time.

|| *Key* || *Name* || *Type* || *Description* ||
|| _PK_ || id || int(11) || Internal ID number. Auto incerments ||
|| ||name || varchar(20) || short name||
|| ||descr|| text || description ||
|| || accessgroup || int(11) || Access group to require, if any. Default is NULL ||
|| || upspeed || int(5) || Upload speed in Kbps ||
|| || downspeed || int(5) || Download speed in Kbps ||
|| || upbucket || int(10) || Upload bucket size in Kb ||
|| || downbucket || int(10) || Download bucket size in Kb ||

{{{
 CREATE TABLE `jungleauth`.`rateplans` (
`id` INT NOT NULL AUTO_INCREMENT ,
`name` VARCHAR( 20 ) NOT NULL ,
`descr` TEXT NOT NULL ,
`accessgroup` INT( 11 ) NULL ,
`upspeed` INT( 5 ) NOT NULL ,
`downspeed` INT( 5 ) NOT NULL ,
`upbucket` INT( 10 ) NOT NULL ,
`downbucket` INT( 10 ) NOT NULL ,
PRIMARY KEY ( `id` )
) ENGINE = InnoDB 
}}}

== radios ==
This table lists radios that are allowed on the network, which rate they should be assigned, which access group (if any) they are in.

|| *Key* || *Name* || *Type* || *Description* ||
|| _PK_ || id || int(11) || Internal ID number. Auto incerments ||
|| || mac || varchar(12) || SM MAC address ||
|| || rateplan || int(11) || rateplans.id of rate that SM is assigned to use ||

{{{
 CREATE TABLE `jungleauth`.`radios` (
`id` INT( 11 ) NOT NULL AUTO_INCREMENT ,
`mac` VARCHAR( 12 ) NOT NULL ,
`rateplan` INT( 11 ) NOT NULL ,
PRIMARY KEY ( `id` ) ,
INDEX rateplan_index( `rateplan` ) ,
INDEX mac_index( mac ) ,
FOREIGN KEY ( rateplan ) REFERENCES rateplans( id ) ON DELETE RESTRICT ON UPDATE CASCADE
) ENGINE = InnoDB 
}}}